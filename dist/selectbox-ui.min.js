/* Copyright 2023 Carlos A. (https://github.com/dealfonso); License: https://opensource.org/license/mit/ */
(function(i,I,e){"use strict";let r={initialBox:null,wrapperClass:"sb-selectboxui-wrapper",wrapperId:null,borderWidth:5,addClasses:true,addBorders:true,addCorners:true,addSides:true,addFocus:true,modifySizes:true,resizeObserver:true};let B=null;let U=null;let y=0;let v=0;function t(l){if(B!=null){l.preventDefault();l.stopPropagation();l.stopImmediatePropagation();let e=l.clientX-y;let t=l.clientY-v;M(U,e,t,U);B.classList.remove("sb-resizing");B=null;let s=U.element;U=null;s.dispatchEvent(new CustomEvent("selectboxui:resize-end",{detail:s.selectBoxUI}))}}function s(l){if(B!=null){l.preventDefault();l.stopPropagation();l.stopImmediatePropagation();let e=l.clientX-y;let t=l.clientY-v;M(U,e,t);let s=U.element;s.dispatchEvent(new CustomEvent("selectboxui:resize",{detail:s.selectBoxUI}))}}function M(e,t=0,s=0,l=null){if(l===null){l=Object.assign({},e)}if(e.borders.left!==null){if(B===e.borders.left){t=Math.max(Math.min(t,e.right-1-e.left),-e.left);l.left+=t}else if(B===e.borders.right){t=Math.min(Math.max(t,1-e.right+e.left),e.width-e.right);l.right+=t}else if(B===e.borders.top){s=Math.max(Math.min(s,e.bottom-1-e.top),-e.top);l.top+=s}else if(B===e.borders.bottom){s=Math.min(Math.max(s,1-e.bottom+e.top),e.height-e.bottom);l.bottom+=s}}if(e.corners.topleft!==null){if(B===e.corners.topleft){t=Math.max(Math.min(t,e.right-1-e.left),-e.left);s=Math.max(Math.min(s,e.bottom-1-e.top),-e.top);l.left+=t;l.top+=s}else if(B===e.corners.bottomleft){t=Math.max(Math.min(t,e.right-1-e.left),-e.left);s=Math.min(Math.max(s,1-e.bottom+e.top),e.height-e.bottom);l.left+=t;l.bottom+=s}else if(B===e.corners.topright){t=Math.min(Math.max(t,1-e.right+e.left),e.width-e.right);s=Math.max(Math.min(s,e.bottom-1-e.top),-e.top);l.right+=t;l.top+=s}else if(B===e.corners.bottomright){t=Math.min(Math.max(t,1-e.right+e.left),e.width-e.right);s=Math.min(Math.max(s,1-e.bottom+e.top),e.height-e.bottom);l.right+=t;l.bottom+=s}}if(e.focus!==null&&B===e.focus){if(t<0){t=Math.max(t,-e.left)}else{t=Math.min(t,e.width-e.right)}if(s<0){s=Math.max(s,-e.top)}else{s=Math.min(s,e.height-e.bottom)}l.left+=t;l.right+=t;l.top+=s;l.bottom+=s;l.left=Math.min(Math.max(l.left,0),e.width);l.right=Math.min(Math.max(l.right,0),e.width);l.top=Math.min(Math.max(l.top,0),e.height);l.bottom=Math.min(Math.max(l.bottom,0),e.height)}if(l.sides.left!==null){l.sides.left.style.top="0px";l.sides.left.style.left="0px";l.sides.left.style.width=`${l.left}px`;l.sides.left.style.height=`${l.height}px`;l.sides.right.style.top="0px";l.sides.right.style.left=`${l.right}px`;l.sides.right.style.width=`${l.width-l.right}px`;l.sides.right.style.height=`${l.height}px`;l.sides.top.style.top=`0px`;l.sides.top.style.left=`${l.left}px`;l.sides.top.style.width=`${l.right-l.left}px`;l.sides.top.style.height=`${l.top}px`;l.sides.bottom.style.top=`${l.bottom}px`;l.sides.bottom.style.left=`${l.left}px`;l.sides.bottom.style.width=`${l.right-l.left}px`;l.sides.bottom.style.height=`${l.height-l.bottom}px`}if(l.borders.left!==null){l.borders.left.style.left=`${l.left}px`;l.borders.left.style.right=`${l.left+l.borders.width}px`;l.borders.left.style.width=`${l.borders.width}px`;l.borders.left.style.height=`100%`;l.borders.right.style.left=`${l.right-l.borders.width}px`;l.borders.right.style.right=`${l.right}px`;l.borders.right.style.width=`${l.borders.width}px`;l.borders.right.style.height=`100%`;l.borders.top.style.top=`${l.top}px`;l.borders.top.style.bottom=`${l.top+l.borders.width}px`;l.borders.top.style.height=`${l.borders.width}px`;l.borders.top.style.width=`100%`;l.borders.bottom.style.top=`${l.bottom-l.borders.width}px`;l.borders.bottom.style.bottom=`${l.bottom}px`;l.borders.bottom.style.height=`${l.borders.width}px`;l.borders.bottom.style.width=`100%`}if(l.corners.topleft!==null){l.corners.topleft.style.top=`${l.top}px`;l.corners.topleft.style.left=`${l.left}px`;l.corners.topleft.style.width=`${l.borders.width}px`;l.corners.topleft.style.height=`${l.borders.width}px`;l.corners.bottomleft.style.top=`${l.bottom-l.borders.width}px`;l.corners.bottomleft.style.left=`${l.left}px`;l.corners.bottomleft.style.width=`${l.borders.width}px`;l.corners.bottomleft.style.height=`${l.borders.width}px`;l.corners.topright.style.top=`${l.top}px`;l.corners.topright.style.left=`${l.right-l.borders.width}px`;l.corners.topright.style.width=`${l.borders.width}px`;l.corners.topright.style.height=`${l.borders.width}px`;l.corners.bottomright.style.top=`${l.bottom-l.borders.width}px`;l.corners.bottomright.style.left=`${l.right-l.borders.width}px`;l.corners.bottomright.style.width=`${l.borders.width}px`;l.corners.bottomright.style.height=`${l.borders.width}px`}if(l.focus!==null){l.focus.style.top=`${l.top}px`;l.focus.style.left=`${l.left}px`;l.focus.style.width=`${l.right-l.left}px`;l.focus.style.height=`${l.bottom-l.top}px`}let o=l.element;if(o!==undefined){o.dispatchEvent(new CustomEvent("selectboxui:changed",{detail:o.selectBoxUI}))}}function $(e,t=null,s=null,l=null,o=null){if(t===null){t=e.left}if(l===null){l=e.right}if(s===null){s=e.top}if(o===null){o=e.bottom}if(isNaN(t)){t=0}if(isNaN(l)){l=e.width}if(isNaN(s)){s=0}if(isNaN(o)){o=e.height}if(t<0){t=e.width+t}if(l<0){l=e.width+l}if(s<0){s=e.height+s}if(o<0){o=e.height+o}t=Math.max(0,Math.min(t,e.width));l=Math.max(0,Math.min(l,e.width));s=Math.max(0,Math.min(s,e.height));o=Math.max(0,Math.min(o,e.height));e.left=Math.min(t,l);e.right=Math.max(l,t);e.top=Math.min(s,o);e.bottom=Math.max(o,s)}function E(s,e){let l=e.split(" ");function o(e,t=1){if(e.endsWith("%")){return parseFloat(e)/100*t}else{return parseFloat(e)}}if(l.length===4){s.left=o(l[0],s.width);s.top=o(l[1],s.height);s.right=o(l[2],s.width);s.bottom=o(l[3],s.height)}else if(l.length===2){let e=o(l[0],s.width);let t=o(l[1],s.height);s.left=e;s.right=s.width-e;s.top=t;s.bottom=s.height-t}else if(l.length===1){let e=o(l[0],s.width);let t=o(l[0],s.height);s.left=e;s.right=s.width-e;s.top=t;s.bottom=s.height-t}else{console.error("Invalid box string");return false}return true}function C(e){let t=e.target;if(t.selectBoxUI===undefined){return}let s=e.contentRect.width;let l=e.contentRect.height;let o=s/t.selectBoxUI.width;let i=l/t.selectBoxUI.height;t.selectBoxUI.left*=o;t.selectBoxUI.right*=o;t.selectBoxUI.top*=i;t.selectBoxUI.bottom*=i;t.selectBoxUI.width=s;t.selectBoxUI.height=l;$(t.selectBoxUI);t.selectBoxUI.wrapper.style.width=`${s}px`;t.selectBoxUI.wrapper.style.height=`${l}px`;t.selectBoxUI.updateInterface();t.dispatchEvent(new CustomEvent("selectboxui:element-resized",{detail:t.selectBoxUI}))}function l(t,e={}){let s={};if(t.dataset.selectboxuiWrapperClass!==undefined){let e=t.dataset.selectboxuiWrapperClass.split(" ");e.push(r.wrapperClass);s.wrapperClass=e.join(" ")}if(t.dataset.selectboxuiWrapperId!==undefined){s.id=t.dataset.selectboxuiWrapperId}if(t.dataset.selectboxuiBorderWidth!==undefined){let e=parseInt(t.dataset.selectboxuiBorderWidth);if(!isNaN(e)){s.borderWidth=e}}if(t.dataset.selectboxuiNoAddClasses!==undefined){if(t.dataset.selectboxuiNoAddClasses.toLowerCase()!=="false"){s.addClasses=false}}if(t.dataset.selectboxuiNoBorders!==undefined){if(t.dataset.selectboxuiNoBorders.toLowerCase()!=="false"){s.addBorders=false}}if(t.dataset.selectboxuiNoCorners!==undefined){if(t.dataset.selectboxuiNoCorners.toLowerCase()!=="false"){s.addCorners=false}}if(t.dataset.selectboxuiNoSides!==undefined){if(t.dataset.selectboxuiNoSides.toLowerCase()!=="false"){s.addSides=false}}if(t.dataset.selectboxuiNoFocus!==undefined){if(t.dataset.selectboxuiNoFocus.toLowerCase()!=="false"){s.addFocus=false}}if(t.dataset.selectboxuiInitialBox!==undefined){s.initialBox=t.dataset.selectboxuiInitialBox}if(t.dataset.selectboxuiNoModifySizes!==undefined){s.modifySizes=t.dataset.selectboxuiNoModifySizes.toLowerCase()!=="false"}if(t.dataset.selectboxuiNoResizeObserver!==undefined){s.resizeObserver=t.dataset.selectboxuiNoResizeObserver.toLowerCase()==="false"}let l=Object.assign({},r,i.selectBoxUI.defaults,s,e);if(t.tagName.toLowerCase()!=="img"){o(t,l)}else{if(t.complete){o(t,l)}else{t.addEventListener("load",function(){o(t,l)});t.addEventListener("error",function(){alert("error")})}}function o(o,e={}){function i(e){if(e.which===1){B=e.target;B.classList.add("sb-resizing");U=o.selectBoxUI;y=e.clientX;v=e.clientY;e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();o.dispatchEvent(new CustomEvent("selectboxui:resize-start",{detail:o.selectBoxUI}))}}function t(e,t,s=null,l=i){let o=I.createElement(e);if(t.trim()!=""){o.classList.add(...t.split(" "))}if(s!==null){s.appendChild(o)}if(l!==null){o.addEventListener("mousedown",l)}return o}let s=t("div",e.wrapperClass,null,null);if(e.id!==null&&e.id!==undefined&&e.id!=""){s.id=e.id}if(e.addClasses){o.classList.forEach(e=>{s.classList.add(e)})}o.classList=[];let l=o.offsetWidth;let r=o.offsetHeight;s.style.width=`${l}px`;s.style.height=`${r}px`;s.style.padding=o.style.padding??"unset";s.style.margin=o.style.margin??"unset";s.style.border=o.style.border??"unset";o.style.padding="0px";o.style.margin="0px";o.style.border="0px";s.style.position="relative";o.style.position="absolute";if(e.modifySizes){o.style.top="0px";o.style.left="0px";o.style.width="100%";o.style.height="100%"}s.style.zIndex=o.style.zIndex;o.style.zIndex="0";let n=null;if(e.addFocus){n=t("div","sb-element sb-focus",s);n.addEventListener("dblclick",function(e){o.selectBoxUI.updateInterface(0,0,o.selectBoxUI.height,o.selectBoxUI.width);e.preventDefault()})}let d=null,a=null,h=null,c=null;if(e.addCorners){d=t("div","sb-element sb-corner sb-corner-topleft",s);a=t("div","sb-element sb-corner sb-corner-bottomleft",s);h=t("div","sb-element sb-corner sb-corner-topright",s);c=t("div","sb-element sb-corner sb-corner-bottomright",s);d.addEventListener("dblclick",function(e){o.selectBoxUI.updateInterface(0,0,null,null);e.preventDefault()});a.addEventListener("dblclick",function(e){o.selectBoxUI.updateInterface(null,0,o.selectBoxUI.height,null);e.preventDefault()});h.addEventListener("dblclick",function(e){o.selectBoxUI.updateInterface(0,null,null,o.selectBoxUI.width);e.preventDefault()});c.addEventListener("dblclick",function(e){o.selectBoxUI.updateInterface(null,null,o.selectBoxUI.height,o.selectBoxUI.width);e.preventDefault()})}let f=null,b=null,u=null,p=null;if(e.addBorders){f=t("div","sb-element sb-border sb-border-left",s);b=t("div","sb-element sb-border sb-border-right",s);u=t("div","sb-element sb-border sb-border-top",s);p=t("div","sb-element sb-border sb-border-bottom",s);f.addEventListener("dblclick",function(e){o.selectBoxUI.updateInterface(null,0,null,null);e.preventDefault()});b.addEventListener("dblclick",function(e){o.selectBoxUI.updateInterface(null,null,null,o.selectBoxUI.width);e.preventDefault()});u.addEventListener("dblclick",function(e){o.selectBoxUI.updateInterface(0,null,null,null);e.preventDefault()});p.addEventListener("dblclick",function(e){o.selectBoxUI.updateInterface(null,null,o.selectBoxUI.height,null);e.preventDefault()})}let x=null,m=null,g=null,w=null;if(e.addSides){x=t("div","sb-element sb-side-box sb-side-box-left",s,null);m=t("div","sb-element sb-side-box sb-side-box-right",s,null);g=t("div","sb-element sb-side-box sb-side-box-top",s,null);w=t("div","sb-element sb-side-box sb-side-box-bottom",s,null)}o.selectBoxUI={left:0,top:0,right:l,bottom:r,width:l,height:r,borders:{width:e.borderWidth,left:f,right:b,top:u,bottom:p},corners:{topleft:d,bottomleft:a,topright:h,bottomright:c},sides:{left:x,right:m,top:g,bottom:w},focus:n,wrapper:s,element:o,observer:new ResizeObserver(e=>{e.forEach(e=>C(e))}),updateInterface:function(e=null,t=null,s=null,l=null){t=t??o.selectBoxUI.left;l=l??o.selectBoxUI.right;e=e??o.selectBoxUI.top;s=s??o.selectBoxUI.bottom;if(t<0){t=o.selectBoxUI.width+t}if(l<0){l=o.selectBoxUI.width+l}if(e<0){e=o.selectBoxUI.height+e}if(s<0){s=o.selectBoxUI.height+s}o.selectBoxUI.left=Math.min(t,l);o.selectBoxUI.right=Math.max(l,t);o.selectBoxUI.top=Math.min(e,s);o.selectBoxUI.bottom=Math.max(s,e);M(o.selectBoxUI)},disable:function(){let e=o.selectBoxUI.wrapper.querySelectorAll(".sb-element");e.forEach(e=>{e.classList.add("sb-ignore-mouse")});o.dispatchEvent(new CustomEvent("selectboxui:disable",{detail:o.selectBoxUI}))},enable:function(){let e=o.selectBoxUI.wrapper.querySelectorAll(".sb-element");e.forEach(e=>{e.classList.remove("sb-ignore-mouse")});o.dispatchEvent(new CustomEvent("selectboxui:enable",{detail:o.selectBoxUI}))},show:function(){let e=o.selectBoxUI.wrapper.querySelectorAll(".sb-element");e.forEach(e=>{e.classList.remove("sb-hidden")});o.dispatchEvent(new CustomEvent("selectboxui:show",{detail:o.selectBoxUI}))},hide:function(){let e=o.selectBoxUI.wrapper.querySelectorAll(".sb-element");e.forEach(e=>{e.classList.add("sb-hidden")});o.dispatchEvent(new CustomEvent("selectboxui:hide",{detail:o.selectBoxUI}))},get:function(){return{left:o.selectBoxUI.left,top:o.selectBoxUI.top,right:o.selectBoxUI.right,bottom:o.selectBoxUI.bottom,width:o.selectBoxUI.width,height:o.selectBoxUI.height}},set:function(e){E(o.selectBoxUI,e);$(o.selectBoxUI);M(o.selectBoxUI)},bounce:function(){o.selectBoxUI.wrapper.classList.add("sb-bounce");o.dispatchEvent(new CustomEvent("selectboxui:bounce-start",{detail:o.selectBoxUI}));setTimeout(()=>{o.selectBoxUI.wrapper.classList.remove("sb-bounce");o.dispatchEvent(new CustomEvent("selectboxui:bounce-end",{detail:o.selectBoxUI}))},2100)}};if(e.initialBox!==null){if(!E(o.selectBoxUI,e.initialBox)){console.error("Invalid initial box")}else{$(o.selectBoxUI)}}M(o.selectBoxUI);o.parentNode.insertBefore(s,o);s.appendChild(o);if(e.resizeObserver){o.selectBoxUI.observer.observe(o)}}}i.selectBoxUI=l;i.selectBoxUI.defaults=Object.assign({},r);i.selectBoxUI.version="1.1.0";i.addEventListener("mouseup",t);i.addEventListener("mousemove",s);if(I.addEventListener){I.addEventListener("DOMContentLoaded",function(){let e=I.querySelectorAll("[data-selectboxui]");e.forEach(e=>{l(e)})})}if(e!==undefined){e.fn.selectBoxUI=function(e,...t){if(this.length===0){return this}if(e==="get"&&this[0].selectBoxUI!==undefined){return this[0].selectBoxUI.get()}this.each(function(){if(typeof e==="string"){if(this.selectBoxUI===undefined){console.error("The element doesn't have a selectbox");return}switch(e){case"disable":this.selectBoxUI.disable();break;case"enable":this.selectBoxUI.enable();break;case"show":this.selectBoxUI.show();break;case"hide":this.selectBoxUI.hide();break;case"set":if(t.length===0){console.error("Missing box string");return}this.selectBoxUI.set(t[0]);break;case"bounce":this.selectBoxUI.bounce();break;default:console.error(`Unknown option ${e}`)}}else{l(this,e)}});return this}}})(window,document,window.$);

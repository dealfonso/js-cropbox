/* Copyright 2023 Carlos A. (https://github.com/dealfonso); License: https://opensource.org/license/mit/ */
(function(e,I,t){"use strict";let s={initialBox:null,wrapperClass:"cb-selectbox-wrapper",wrapperId:null,borderWidth:5,addClasses:true,addBorders:true,addCorners:true,addSides:true,addFocus:true,modifySizes:true,resizeObserver:true};let B=null;let y=null;let U=0;let v=0;function l(l){if(B!=null){l.preventDefault();l.stopPropagation();l.stopImmediatePropagation();let e=l.clientX-U;let t=l.clientY-v;M(y,e,t,y);B.classList.remove("cb-resizing");B=null;y=null}}function o(l){if(B!=null){l.preventDefault();l.stopPropagation();l.stopImmediatePropagation();let e=l.clientX-U;let t=l.clientY-v;M(y,e,t)}}function M(e,t=0,l=0,o=null){if(o===null){o=Object.assign({},e)}if(e.borders.left!==null){if(B===e.borders.left){t=Math.max(Math.min(t,e.right-1-e.left),-e.left);o.left+=t}else if(B===e.borders.right){t=Math.min(Math.max(t,1-e.right+e.left),e.width-e.right);o.right+=t}else if(B===e.borders.top){l=Math.max(Math.min(l,e.bottom-1-e.top),-e.top);o.top+=l}else if(B===e.borders.bottom){l=Math.min(Math.max(l,1-e.bottom+e.top),e.height-e.bottom);o.bottom+=l}}if(e.corners.topleft!==null){if(B===e.corners.topleft){t=Math.max(Math.min(t,e.right-1-e.left),-e.left);l=Math.max(Math.min(l,e.bottom-1-e.top),-e.top);o.left+=t;o.top+=l}else if(B===e.corners.bottomleft){t=Math.max(Math.min(t,e.right-1-e.left),-e.left);l=Math.min(Math.max(l,1-e.bottom+e.top),e.height-e.bottom);o.left+=t;o.bottom+=l}else if(B===e.corners.topright){t=Math.min(Math.max(t,1-e.right+e.left),e.width-e.right);l=Math.max(Math.min(l,e.bottom-1-e.top),-e.top);o.right+=t;o.top+=l}else if(B===e.corners.bottomright){t=Math.min(Math.max(t,1-e.right+e.left),e.width-e.right);l=Math.min(Math.max(l,1-e.bottom+e.top),e.height-e.bottom);o.right+=t;o.bottom+=l}}if(e.focus!==null&&B===e.focus){if(t<0){t=Math.max(t,-e.left)}else{t=Math.min(t,e.width-e.right)}if(l<0){l=Math.max(l,-e.top)}else{l=Math.min(l,e.height-e.bottom)}o.left+=t;o.right+=t;o.top+=l;o.bottom+=l;o.left=Math.min(Math.max(o.left,0),e.width);o.right=Math.min(Math.max(o.right,0),e.width);o.top=Math.min(Math.max(o.top,0),e.height);o.bottom=Math.min(Math.max(o.bottom,0),e.height)}if(o.sides.left!==null){o.sides.left.style.top="0px";o.sides.left.style.left="0px";o.sides.left.style.width=`${o.left}px`;o.sides.left.style.height=`${o.height}px`;o.sides.right.style.top="0px";o.sides.right.style.left=`${o.right}px`;o.sides.right.style.width=`${o.width-o.right}px`;o.sides.right.style.height=`${o.height}px`;o.sides.top.style.top=`0px`;o.sides.top.style.left=`${o.left}px`;o.sides.top.style.width=`${o.right-o.left}px`;o.sides.top.style.height=`${o.top}px`;o.sides.bottom.style.top=`${o.bottom}px`;o.sides.bottom.style.left=`${o.left}px`;o.sides.bottom.style.width=`${o.right-o.left}px`;o.sides.bottom.style.height=`${o.height-o.bottom}px`}if(o.borders.left!==null){o.borders.left.style.left=`${o.left}px`;o.borders.left.style.right=`${o.left+o.borders.width}px`;o.borders.left.style.width=`${o.borders.width}px`;o.borders.left.style.height=`100%`;o.borders.right.style.left=`${o.right-o.borders.width}px`;o.borders.right.style.right=`${o.right}px`;o.borders.right.style.width=`${o.borders.width}px`;o.borders.right.style.height=`100%`;o.borders.top.style.top=`${o.top}px`;o.borders.top.style.bottom=`${o.top+o.borders.width}px`;o.borders.top.style.height=`${o.borders.width}px`;o.borders.top.style.width=`100%`;o.borders.bottom.style.top=`${o.bottom-o.borders.width}px`;o.borders.bottom.style.bottom=`${o.bottom}px`;o.borders.bottom.style.height=`${o.borders.width}px`;o.borders.bottom.style.width=`100%`}if(o.corners.topleft!==null){o.corners.topleft.style.top=`${o.top}px`;o.corners.topleft.style.left=`${o.left}px`;o.corners.topleft.style.width=`${o.borders.width}px`;o.corners.topleft.style.height=`${o.borders.width}px`;o.corners.bottomleft.style.top=`${o.bottom-o.borders.width}px`;o.corners.bottomleft.style.left=`${o.left}px`;o.corners.bottomleft.style.width=`${o.borders.width}px`;o.corners.bottomleft.style.height=`${o.borders.width}px`;o.corners.topright.style.top=`${o.top}px`;o.corners.topright.style.left=`${o.right-o.borders.width}px`;o.corners.topright.style.width=`${o.borders.width}px`;o.corners.topright.style.height=`${o.borders.width}px`;o.corners.bottomright.style.top=`${o.bottom-o.borders.width}px`;o.corners.bottomright.style.left=`${o.right-o.borders.width}px`;o.corners.bottomright.style.width=`${o.borders.width}px`;o.corners.bottomright.style.height=`${o.borders.width}px`}if(o.focus!==null){o.focus.style.top=`${o.top}px`;o.focus.style.left=`${o.left}px`;o.focus.style.width=`${o.right-o.left}px`;o.focus.style.height=`${o.bottom-o.top}px`}}function $(e,t=null,l=null,o=null,i=null){if(t===null){t=e.left}if(o===null){o=e.right}if(l===null){l=e.top}if(i===null){i=e.bottom}if(isNaN(t)){t=0}if(isNaN(o)){o=e.width}if(isNaN(l)){l=0}if(isNaN(i)){i=e.height}if(t<0){t=e.width+t}if(o<0){o=e.width+o}if(l<0){l=e.height+l}if(i<0){i=e.height+i}t=Math.max(0,Math.min(t,e.width));o=Math.max(0,Math.min(o,e.width));l=Math.max(0,Math.min(l,e.height));i=Math.max(0,Math.min(i,e.height));e.left=Math.min(t,o);e.right=Math.max(o,t);e.top=Math.min(l,i);e.bottom=Math.max(i,l)}function L(l,e){let o=e.split(" ");function i(e,t=1){if(e.endsWith("%")){return parseFloat(e)/100*t}else{return parseFloat(e)}}if(o.length===4){l.left=i(o[0],l.width);l.top=i(o[1],l.height);l.right=i(o[2],l.width);l.bottom=i(o[3],l.height)}else if(o.length===2){let e=i(o[0],l.width);let t=i(o[1],l.height);l.left=e;l.right=l.width-e;l.top=t;l.bottom=l.height-t}else if(o.length===1){let e=i(o[0],l.width);let t=i(o[0],l.height);l.left=e;l.right=l.width-e;l.top=t;l.bottom=l.height-t}else{console.error("Invalid box string");return false}return true}function C(e){let t=e.target;if(t.selectBoxUI===undefined){return}let l=e.contentRect.width;let o=e.contentRect.height;let i=l/t.selectBoxUI.width;let s=o/t.selectBoxUI.height;t.selectBoxUI.left*=i;t.selectBoxUI.right*=i;t.selectBoxUI.top*=s;t.selectBoxUI.bottom*=s;t.selectBoxUI.width=l;t.selectBoxUI.height=o;$(t.selectBoxUI);t.selectBoxUI.wrapper.style.width=`${l}px`;t.selectBoxUI.wrapper.style.height=`${o}px`;t.selectBoxUI.updateInterface()}function i(t,e={}){let l={};if(t.dataset.selectboxuiWrapperClass!==undefined){let e=t.dataset.selectboxuiWrapperClass.split(" ");e.push("cb-selectbox-wrapper");l.wrapperClass=e.join(" ")}if(t.dataset.selectboxuiWrapperId!==undefined){l.id=t.dataset.selectboxuiWrapperId}if(t.dataset.selectboxuiBorderWidth!==undefined){let e=parseInt(t.dataset.selectboxuiBorderWidth);if(!isNaN(e)){l.borderWidth=e}}if(t.dataset.selectboxuiNoAddClasses!==undefined){if(t.dataset.selectboxuiNoAddClasses.toLowerCase()!=="false"){l.addClasses=false}}if(t.dataset.selectboxuiNoBorders!==undefined){if(t.dataset.selectboxuiNoBorders.toLowerCase()!=="false"){l.addBorders=false}}if(t.dataset.selectboxuiNoCorners!==undefined){if(t.dataset.selectboxuiNoCorners.toLowerCase()!=="false"){l.addCorners=false}}if(t.dataset.selectboxuiNoSides!==undefined){if(t.dataset.selectboxuiNoSides.toLowerCase()!=="false"){l.addSides=false}}if(t.dataset.selectboxuiNoFocus!==undefined){if(t.dataset.selectboxuiNoFocus.toLowerCase()!=="false"){l.addFocus=false}}if(t.dataset.selectboxuiInitialBox!==undefined){l.initialBox=t.dataset.selectboxuiInitialBox}if(t.dataset.selectboxuiNoModifySizes!==undefined){l.modifySizes=t.dataset.selectboxuiNoModifySizes.toLowerCase()!=="false"}if(t.dataset.selectboxuiNoResizeObserver!==undefined){o.resizeObserver=t.dataset.selectboxuiNoResizeObserver.toLowerCase()!=="false"}let o=Object.assign({},s,l,e);if(t.tagName.toLowerCase()!=="img"){i(t,o)}else{if(t.complete){i(t,o)}else{t.addEventListener("load",function(){i(t,o)});t.addEventListener("error",function(){alert("error")})}}function i(i,e={}){function s(e){if(e.which===1){B=e.target;B.classList.add("cb-resizing");y=i.selectBoxUI;U=e.clientX;v=e.clientY;e.preventDefault();e.stopPropagation();e.stopImmediatePropagation()}}function t(e,t,l=null,o=s){let i=I.createElement(e);if(t.trim()!=""){i.classList.add(...t.split(" "))}if(l!==null){l.appendChild(i)}if(o!==null){i.addEventListener("mousedown",o)}return i}let l=t("div",e.wrapperClass,null,null);if(e.id!==null&&e.id!==undefined&&e.id!=""){l.id=e.id}if(e.addClasses){i.classList.forEach(e=>{l.classList.add(e)})}i.classList=[];let o=i.offsetWidth;let r=i.offsetHeight;l.style.width=`${o}px`;l.style.height=`${r}px`;l.style.padding=i.style.padding??"unset";l.style.margin=i.style.margin??"unset";l.style.border=i.style.border??"unset";i.style.padding="0px";i.style.margin="0px";i.style.border="0px";l.style.position="relative";i.style.position="absolute";if(e.modifySizes){i.style.top="0px";i.style.left="0px";i.style.width="100%";i.style.height="100%"}l.style.zIndex=i.style.zIndex;i.style.zIndex="0";let n=null;if(e.addFocus){n=t("div","cb-element cb-focus",l);n.addEventListener("dblclick",function(e){i.selectBoxUI.updateInterface(0,0,i.selectBoxUI.height,i.selectBoxUI.width);e.preventDefault()})}let d=null,a=null,h=null,c=null;if(e.addCorners){d=t("div","cb-element cb-corner cb-corner-topleft",l);a=t("div","cb-element cb-corner cb-corner-bottomleft",l);h=t("div","cb-element cb-corner cb-corner-topright",l);c=t("div","cb-element cb-corner cb-corner-bottomright",l);d.addEventListener("dblclick",function(e){i.selectBoxUI.updateInterface(0,0,null,null);e.preventDefault()});a.addEventListener("dblclick",function(e){i.selectBoxUI.updateInterface(null,0,i.selectBoxUI.height,null);e.preventDefault()});h.addEventListener("dblclick",function(e){i.selectBoxUI.updateInterface(0,null,null,i.selectBoxUI.width);e.preventDefault()});c.addEventListener("dblclick",function(e){i.selectBoxUI.updateInterface(null,null,i.selectBoxUI.height,i.selectBoxUI.width);e.preventDefault()})}let f=null,b=null,p=null,u=null;if(e.addBorders){f=t("div","cb-element cb-border cb-border-left",l);b=t("div","cb-element cb-border cb-border-right",l);p=t("div","cb-element cb-border cb-border-top",l);u=t("div","cb-element cb-border cb-border-bottom",l);f.addEventListener("dblclick",function(e){i.selectBoxUI.updateInterface(null,0,null,null);e.preventDefault()});b.addEventListener("dblclick",function(e){i.selectBoxUI.updateInterface(null,null,null,i.selectBoxUI.width);e.preventDefault()});p.addEventListener("dblclick",function(e){i.selectBoxUI.updateInterface(0,null,null,null);e.preventDefault()});u.addEventListener("dblclick",function(e){i.selectBoxUI.updateInterface(null,null,i.selectBoxUI.height,null);e.preventDefault()})}let x=null,m=null,g=null,w=null;if(e.addSides){x=t("div","cb-element cb-side-box cb-side-box-left",l,null);m=t("div","cb-element cb-side-box cb-side-box-right",l,null);g=t("div","cb-element cb-side-box cb-side-box-top",l,null);w=t("div","cb-element cb-side-box cb-side-box-bottom",l,null)}i.selectBoxUI={left:0,top:0,right:o,bottom:r,width:o,height:r,borders:{width:e.borderWidth,left:f,right:b,top:p,bottom:u},corners:{topleft:d,bottomleft:a,topright:h,bottomright:c},sides:{left:x,right:m,top:g,bottom:w},focus:n,wrapper:l,observer:new ResizeObserver(e=>{e.forEach(e=>C(e))}),updateInterface:function(e=null,t=null,l=null,o=null){t=t??i.selectBoxUI.left;o=o??i.selectBoxUI.right;e=e??i.selectBoxUI.top;l=l??i.selectBoxUI.bottom;if(t<0){t=i.selectBoxUI.width+t}if(o<0){o=i.selectBoxUI.width+o}if(e<0){e=i.selectBoxUI.height+e}if(l<0){l=i.selectBoxUI.height+l}i.selectBoxUI.left=Math.min(t,o);i.selectBoxUI.right=Math.max(o,t);i.selectBoxUI.top=Math.min(e,l);i.selectBoxUI.bottom=Math.max(l,e);M(i.selectBoxUI)},disable:function(){let e=i.selectBoxUI.wrapper.querySelectorAll(".cb-element");e.forEach(e=>{e.classList.add("cb-ignore-mouse")})},enable:function(){let e=i.selectBoxUI.wrapper.querySelectorAll(".cb-element");e.forEach(e=>{e.classList.remove("cb-ignore-mouse")})},show:function(){let e=i.selectBoxUI.wrapper.querySelectorAll(".cb-element");e.forEach(e=>{e.classList.remove("cb-hidden")})},hide:function(){let e=i.selectBoxUI.wrapper.querySelectorAll(".cb-element");e.forEach(e=>{e.classList.add("cb-hidden")})},get:function(){return{left:i.selectBoxUI.left,top:i.selectBoxUI.top,right:i.selectBoxUI.right,bottom:i.selectBoxUI.bottom,width:i.selectBoxUI.width,height:i.selectBoxUI.height}},set:function(e){L(i.selectBoxUI,e);$(i.selectBoxUI);M(i.selectBoxUI)}};if(e.initialBox!==null){if(!L(i.selectBoxUI,e.initialBox)){console.error("Invalid initial box")}else{$(i.selectBoxUI)}}M(i.selectBoxUI);i.parentNode.insertBefore(l,i);l.appendChild(i);if(e.resizeObserver){i.selectBoxUI.observer.observe(i)}}}e.selectBoxUI=i;e.addEventListener("mouseup",l);e.addEventListener("mousemove",o);if(I.addEventListener){I.addEventListener("DOMContentLoaded",function(){let e=I.querySelectorAll("[data-selectboxui]");e.forEach(e=>{i(e)})})}if(t!==undefined){t.fn.selectBoxUI=function(e,...t){if(this.length===0){return this}if(e==="get"&&this[0].selectBoxUI!==undefined){return this[0].selectBoxUI.get()}this.each(function(){if(typeof e==="string"){if(this.selectBoxUI===undefined){console.error("The element doesn't have a selectbox");return}switch(e){case"disable":this.selectBoxUI.disable();break;case"enable":this.selectBoxUI.enable();break;case"show":this.selectBoxUI.show();break;case"hide":this.selectBoxUI.hide();break;case"set":if(t.length===0){console.error("Missing box string");return}this.selectBoxUI.set(t[0]);break;default:console.error(`Unknown option ${e}`)}}else{i(this,e)}});return this}}})(window,document,window.$);
